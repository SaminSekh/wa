<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp +</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#008069">
</head>

<body>
    <div class="app-container">
        <header>
            <div class="header-top">
                <h1>WhatsApp Manager</h1>
                <div class="header-actions">
                    <button class="header-btn" title="Search">
                        <svg viewBox="0 0 24 24" width="22" height="22">
                            <path fill="currentColor"
                                d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L19.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                        </svg>
                    </button>
                    <div class="dropdown">
                        <button id="menuBtn" class="header-btn" title="More Options">
                            <svg viewBox="0 0 24 24" width="22" height="22">
                                <path fill="currentColor"
                                    d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                            </svg>
                        </button>
                        <div id="menuDropdown" class="dropdown-content">
                            <button id="themeToggle">üåô Dark Mode</button>
                            <button id="notificationPermission">üîî Notifications</button>
                            <button id="installApp" style="display: none;">üì± Install App</button>
                            <button id="refreshApp">üîÑ Refresh App</button>
                            <button id="exportData">üì§ Export Contacts</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="search-container-top">
                <div class="search-bar">
                    <span class="icon">üîç</span>
                    <input type="text" id="globalSearch" placeholder="Search contacts...">
                </div>
            </div>
        </header>

        <main id="mainContent">
            <!-- Dashboard Tab -->
            <section id="dashboard" class="tab-content active">
                <div class="status-filters">
                    <button class="filter-btn" data-filter="today">Today</button>
                    <button class="filter-btn active" data-filter="now">‚ö°Now</button>
                    <button class="filter-btn" data-filter="next_day">Tomorrow</button>
                    <button class="filter-btn" data-filter="week">Week</button>
                    <button class="filter-btn" data-filter="month">Month</button>

                    <div class="filter-separator"></div>

                    <button class="filter-btn" data-filter="pending">Pending</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>

                    <div class="filter-separator"></div>

                    <!-- Sort Filters for Dashboard -->
                    <button class="filter-btn active" data-context="dashboard-sort" data-sort="time">üïí Time</button>
                    <button class="filter-btn" data-context="dashboard-sort" data-sort="asc">AZ ‚¨áÔ∏è</button>
                    <button class="filter-btn" data-context="dashboard-sort" data-sort="desc">ZA ‚¨ÜÔ∏è</button>
                </div>
                <div id="dashboardList" class="contact-list">
                    <!-- Scheduled contacts -->
                </div>
            </section>

            <!-- Contacts Tab -->
            <section id="contacts" class="tab-content">
                <div class="status-filters">
                    <button class="filter-btn active" data-context="contacts" data-filter="all">All</button>
                    <button class="filter-btn" data-context="contacts" data-filter="daily">Daily</button>
                    <button class="filter-btn" data-context="contacts" data-filter="weekly">Weekly</button>
                    <button class="filter-btn" data-context="contacts" data-filter="monthly">Monthly</button>

                    <div class="filter-separator"></div>

                    <!-- Sort Filters for Contacts -->
                    <button class="filter-btn active" data-context="contacts-sort" data-sort="asc">AZ ‚¨áÔ∏è</button>
                    <button class="filter-btn" data-context="contacts-sort" data-sort="desc">ZA ‚¨ÜÔ∏è</button>
                    <button class="filter-btn" data-context="contacts-sort" data-sort="day">üìÖ Day</button>
                    <button class="filter-btn" data-context="contacts-sort" data-sort="date">üî¢ Date</button>
                </div>
                <div id="contactsList" class="contact-list">
                    <!-- All contacts -->
                </div>
            </section>

            <!-- Random Today Tab -->
            <section id="random" class="tab-content">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 10px 15px 5px;">
                    <h2 style="margin: 0; font-size: 18px;">Quick Pick (Random)</h2>
                    <button class="refresh-icon-btn" onclick="refreshRandom()" title="Refresh List"
                        style="background: none; border: none; color: var(--wa-green); cursor: pointer; padding: 5px; display: flex; align-items: center;">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor"
                                d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                        </svg>
                    </button>
                </div>
                <div id="randomList" class="contact-list">
                    <!-- 5 random contacts -->
                </div>
            </section>

            <!-- Import Tab -->
            <section id="import" class="tab-content">
                <div class="import-actions" style="padding: 20px; text-align: center;">
                    <p style="margin-bottom: 20px; color: var(--wa-text-secondary);">Import your contacts from CSV or
                        VCF files.</p>
                    <input type="file" id="importFile" accept=".csv,.vcf" style="display: none;">
                    <button class="btn btn-confirm" onclick="document.getElementById('importFile').click()">Choose
                        File</button>
                </div>
                <div id="importPreview" class="contact-list">
                    <!-- Preview of imported contacts -->
                </div>
                <div id="importConfirmContainer" style="display: none; padding: 15px; text-align: right;">
                    <button id="saveImported" class="btn btn-confirm">Save Selected</button>
                </div>
            </section>

            <!-- Manage Tab (Schedule Creator) -->
            <section id="manage" class="tab-content">
                <!-- Manage Control Panel -->
                <div class="manage-panel"
                    style="padding: 15px; background: var(--wa-white); border-bottom: 1px solid var(--wa-border);">
                    <h3 style="margin: 0 0 10px 0; font-size: 16px;">Create Schedule</h3>
                    <div class="form-group" style="margin-bottom: 10px;">
                        <select id="manageFreq" style="width: 100%; padding: 8px;">
                            <option value="daily">Daily</option>
                            <option value="2_day">2 times a day</option>
                            <option value="3_day">3 times a day</option>
                            <option value="weekly" selected>Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>

                    <!-- Dynamic Day/Date Inputs for Manage -->
                    <div id="manageDayContainer" style="margin-bottom: 15px;">
                        <!-- For Weekly -->
                        <div id="manageWeeklyInput" style="display: none;">
                            <label
                                style="font-size: 12px; color: var(--wa-text-secondary); display: block; margin-bottom: 5px;">Days
                                of Week</label>
                            <div id="manageWeeklyDaysContainer">
                                <!-- Dynamic rows added here -->
                            </div>
                            <button type="button" class="btn-add-small" id="addManageWeeklyDayBtn"
                                style="margin-top: 5px;">+ Add Day</button>
                        </div>
                        <!-- For Monthly -->
                        <div id="manageMonthlyInput" style="display: none;">
                            <label
                                style="font-size: 12px; color: var(--wa-text-secondary); display: block; margin-bottom: 5px;">Dates
                                of Month</label>
                            <div id="manageMonthlyDaysContainer">
                                <!-- Dynamic rows added here -->
                            </div>
                            <button type="button" class="btn-add-small" id="addManageMonthlyDayBtn"
                                style="margin-top: 5px;">+ Add Date</button>
                        </div>
                    </div>

                    <div id="manageTimeGroups">
                        <div id="manageTimeGroup1" class="form-group" style="margin-bottom: 10px;">
                            <label id="manageTime1Label"
                                style="font-size: 12px; color: var(--wa-text-secondary);">Preferred Time</label>
                            <input type="time" id="manageTime1" value="10:00" style="width: 100%; padding: 8px;">
                        </div>
                        <div id="manageTimeGroup2" class="form-group" style="margin-bottom: 10px; display: none;">
                            <label style="font-size: 12px; color: var(--wa-text-secondary);">Preferred Time 2</label>
                            <input type="time" id="manageTime2" value="14:00" style="width: 100%; padding: 8px;">
                        </div>
                        <div id="manageTimeGroup3" class="form-group" style="margin-bottom: 15px; display: none;">
                            <label style="font-size: 12px; color: var(--wa-text-secondary);">Preferred Time 3</label>
                            <input type="time" id="manageTime3" value="19:00" style="width: 100%; padding: 8px;">
                        </div>
                    </div>

                    <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px; padding: 0 5px;">
                        <input type="checkbox" id="manageShowIncludedOnly"
                            style="width: 16px; height: 16px; accent-color: var(--wa-green); cursor: pointer;">
                        <label for="manageShowIncludedOnly"
                            style="font-size: 14px; color: var(--wa-text); cursor: pointer;">Show only included
                            contacts</label>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 13px; color: var(--wa-text-secondary);">
                            <span id="manageIncludedCount">0</span> contacts included
                        </div>
                        <button id="applyScheduleBtn" class="btn btn-confirm" style="font-size: 13px;">Apply to
                            Selected</button>
                    </div>
                </div>

                <!-- View Mode and Sort Filters -->
                <div class="status-filters"
                    style="padding: 10px 15px; background: var(--wa-bg); border-bottom: 1px solid var(--wa-border);">
                    <button class="filter-btn active" data-context="manage" data-filter="all">All</button>
                    <button class="filter-btn" data-context="manage" data-filter="by_day">By Day</button>
                    <button class="filter-btn" data-context="manage" data-filter="by_date">By Date</button>

                    <div class="filter-separator"></div>

                    <!-- Sort Filters for Manage -->
                    <button class="filter-btn active" data-context="manage-sort" data-sort="asc">AZ ‚¨áÔ∏è</button>
                    <button class="filter-btn" data-context="manage-sort" data-sort="desc">ZA ‚¨ÜÔ∏è</button>
                    <button class="filter-btn" data-context="manage-sort" data-sort="day">üìÖ Day</button>
                    <button class="filter-btn" data-context="manage-sort" data-sort="date">üî¢ Date</button>
                </div>

                <!-- Manage List -->
                <div id="manageList" class="contact-list" style="padding-bottom: 80px;">
                    <!-- Checkbox list of all contacts -->
                </div>
            </section>


        </main>

        <!-- Bulk Action Bar (Hidden by default) -->
        <div id="bulkActionBar" class="bulk-action-bar">
            <button class="bulk-close-btn" onclick="clearSelection()">√ó</button>
            <div class="selected-count">
                <span id="selectedCount">0</span> selected
            </div>
            <div class="bulk-btns">
                <button class="btn-bulk-clear" onclick="selectAll()">Select All</button>
                <button class="btn btn-cancel" onclick="deleteSelectedEntries()"
                    style="background-color: var(--wa-red); border: none; color: white;">Delete</button>
                <button class="btn btn-confirm" onclick="openBulkEditModal()">Edit</button>
                <button class="btn btn-confirm" onclick="openBulkMessageModal()">Message</button>
            </div>
        </div>



        <nav class="bottom-tabs">
            <div class="tab active" data-tab="dashboard">
                <span class="tab-icon">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor"
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-11v4h4v-4h-4z" />
                    </svg>
                </span>
                <span class="tab-label">Chats</span>
            </div>
            <div class="tab" data-tab="contacts">
                <span class="tab-icon">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor"
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8-1.41-1.42z" />
                    </svg>
                </span>
                <span class="tab-label">Contact</span>
            </div>
            <div class="tab" data-tab="random">
                <span class="tab-icon">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor"
                            d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z" />
                    </svg>
                </span>
                <span class="tab-label">Random</span>
            </div>
            <div class="tab" data-tab="import">
                <span class="tab-icon">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor"
                            d="M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z" />
                    </svg>
                </span>
                <span class="tab-label">Import</span>
            </div>
            <div class="tab" data-tab="manage">
                <span class="tab-icon">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor"
                            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                    </svg>
                </span>
                <span class="tab-label">Manage</span>
            </div>
        </nav>

        <button id="addContactBtn" class="fab">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="white" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
        </button>
    </div>

    <!-- Add/Edit Contact Modal -->
    <div id="contactModal" class="modal-overlay">
        <div class="modal">
            <h2 id="modalTitle">Add New Contact</h2>
            <form id="contactForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label>Profile Image</label>
                    <input type="hidden" id="contactImg" value="">
                    <div id="avatarPreview" class="contact-img" style="margin: 10px auto; width: 80px; height: 80px;">
                        <img src="https://ui-avatars.com/api/?name=User&background=random" id="previewImg">
                    </div>
                    <div style="text-align: center;">
                        <label for="imageUpload" class="upload-label">üìÅ Upload from Gallery</label>
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    </div>
                    <div class="avatar-gallery" id="avatarGallery">
                        <!-- 20 avatars will be injected here -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="contactName" required placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Phone Number (with Country Code)</label>
                    <input type="tel" id="contactPhone" required placeholder="+1234567890">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select id="contactFreq">
                        <option value="2_day">2 times a day</option>
                        <option value="3_day">3 times a day</option>
                        <option value="daily" selected>Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div id="weeklyOptions" class="form-group" style="display: none;">
                    <label>Days of Week</label>
                    <div id="weeklyDaysContainer">
                        <!-- Dynamic rows will be added here -->
                    </div>
                    <button type="button" class="btn-add-small" id="addWeeklyDayBtn" style="margin-top: 5px;">+ Add
                        Day</button>
                </div>
                <div id="monthlyOptions" class="form-group" style="display: none;">
                    <label>Days of Month</label>
                    <div id="monthlyDaysContainer">
                        <!-- Dynamic rows will be added here -->
                    </div>
                    <button type="button" class="btn-add-small" id="addMonthlyDayBtn" style="margin-top: 5px;">+ Add
                        Date</button>
                </div>
                <div id="time1Group" class="form-group">
                    <label id="time1Label">Preferred Time</label>
                    <input type="time" id="contactTime1" value="22:00">
                </div>
                <div id="time2Group" class="form-group" style="display: none;">
                    <label>Preferred Time 2</label>
                    <input type="time" id="contactTime2" value="14:00">
                </div>
                <div id="time3Group" class="form-group" style="display: none;">
                    <label>Preferred Time 3</label>
                    <input type="time" id="contactTime3" value="19:00">
                </div>
                <div class="modal-btns">
                    <button type="button" class="btn btn-cancel" id="closeModal">Cancel</button>
                    <button type="submit" class="btn btn-confirm">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Message Modal -->
    <div id="messageModal" class="modal-overlay">
        <div class="modal">
            <h2>Quick Message</h2>

            <!-- Preset Messages Section -->
            <div class="preset-messages-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="font-size: 14px; color: var(--wa-text-secondary); margin: 0;">Quick Presets:</label>
                    <button type="button" class="btn-add-preset" onclick="addNewPreset()" title="Add New Preset">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </button>
                </div>
                <div id="presetMessagesContainer" class="preset-messages-container">
                    <!-- Preset messages will be rendered here -->
                </div>
            </div>

            <div class="form-group">
                <label for="quickMessageText">Type your message:</label>
                <textarea id="quickMessageText" rows="4" placeholder="Hello! How are you?"
                    style="width: 100%; padding: 10px; border: 1px solid var(--wa-border); border-radius: 4px; background: var(--wa-input-bg); color: var(--wa-text); outline-color: var(--wa-green); resize: none;"></textarea>
            </div>
            <div class="modal-btns">
                <button type="button" class="btn btn-cancel" onclick="closeMessageModal()">Cancel</button>
                <button type="button" class="btn btn-confirm" onclick="sendQuickMessage()">Send to WhatsApp</button>
            </div>
        </div>
    </div>

    <!-- Bulk Message Modal -->
    <div id="bulkMessageModal" class="modal-overlay">
        <div class="modal">
            <h2>Send Bulk Message</h2>
            <div id="bulkProgressInfo"
                style="margin-bottom: 10px; font-size: 14px; font-weight: 500; color: var(--wa-green);">
                Sending to <span id="bulkTotal">0</span> contacts...
            </div>
            <div class="form-group" id="bulkMessageInputGroup">
                <label for="bulkMessageText">Type your bulk message:</label>
                <textarea id="bulkMessageText" rows="4" placeholder="Hello! This is a bulk message."
                    style="width: 100%; padding: 10px; border: 1px solid var(--wa-border); border-radius: 4px; background: var(--wa-input-bg); color: var(--wa-text); outline-color: var(--wa-green); resize: none;"></textarea>
            </div>
            <div id="bulkSendingStatus" style="display: none; text-align: center; padding: 20px 0;">
                <div style="font-size: 16px; margin-bottom: 10px;">Ready for next contact?</div>
                <div id="bulkCurrentContactName" style="font-weight: 600; font-size: 18px; margin-bottom: 15px;">Target
                    Name</div>
                <button class="btn btn-confirm" id="btnSendNext" onclick="sendNextInQueue()" style="width: 100%;">Open
                    WhatsApp & Send</button>
            </div>
            <div class="modal-btns" id="bulkInitialBtns">
                <button type="button" class="btn btn-cancel" onclick="closeBulkMessageModal()">Cancel</button>
                <button type="button" class="btn btn-confirm" onclick="startBulkSend()">Start Sending</button>
            </div>
            <div class="modal-btns" id="bulkFinishedBtns" style="display: none;">
                <button type="button" class="btn btn-confirm" onclick="closeBulkMessageModal()"
                    style="width: 100%;">Done</button>
            </div>
        </div>
    </div>

    <!-- Bulk Edit Modal -->
    <div id="bulkEditModal" class="modal-overlay">
        <div class="modal">
            <h2>Bulk Edit Contacts</h2>
            <p style="font-size: 13px; color: var(--wa-text-secondary); margin-bottom: 15px;">
                Changes will apply to <span id="bulkEditCount">0</span> selected contacts.
                Leave fields blank to keep existing values.
            </p>
            <form id="bulkEditForm">
                <div class="form-group">
                    <label>New Name (Optional)</label>
                    <input type="text" id="bulkName" placeholder="Set same name for all...">
                </div>

                <div class="form-group">
                    <label>Update Avatar</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="hidden" id="bulkImg" value="">
                        <div id="bulkAvatarPreview" class="contact-img" style="width: 50px; height: 50px;">
                            <img src="" id="bulkPreviewImg" style="display: none;">
                            <span id="bulkNoImgRaw" style="font-size: 12px; color: grey;">No Change</span>
                        </div>
                        <button type="button" class="btn-add-small" id="btnBulkSelectAvatar">Select Avatar</button>
                        <button type="button" class="btn-remove-small" onclick="clearBulkAvatar()">Clear</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Frequency</label>
                    <select id="bulkFreq">
                        <option value="">(No Change)</option>
                        <option value="2_day">2 times a day</option>
                        <option value="3_day">3 times a day</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>

                <div id="bulkWeeklyOptions" class="form-group" style="display: none;">
                    <label>Days of Week</label>
                    <div id="bulkWeeklyDaysContainer"></div>
                    <button type="button" class="btn-add-small" id="addBulkWeeklyDayBtn">+ Add Day</button>
                </div>

                <div id="bulkMonthlyOptions" class="form-group" style="display: none;">
                    <label>Days of Month</label>
                    <div id="bulkMonthlyDaysContainer"></div>
                    <button type="button" class="btn-add-small" id="addBulkMonthlyDayBtn">+ Add Date</button>
                </div>

                <div class="form-group">
                    <label>Preferred Time</label>
                    <input type="time" id="bulkTime1">
                </div>
                <div id="bulkTime2Group" class="form-group" style="display: none;">
                    <label>Preferred Time 2</label>
                    <input type="time" id="bulkTime2">
                </div>
                <div id="bulkTime3Group" class="form-group" style="display: none;">
                    <label>Preferred Time 3</label>
                    <input type="time" id="bulkTime3">
                </div>

                <div class="modal-btns">
                    <button type="button" class="btn btn-cancel" onclick="closeBulkEditModal()">Cancel</button>
                    <button type="submit" class="btn btn-confirm">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js');
            });
        }
    </script>
</body>

</html>